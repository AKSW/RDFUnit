@prefix dc:      <http://purl.org/dc/elements/1.1/> .
@prefix rutg:    <http://rdfunit.aksw.org/data/generators#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rlog:    <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/rlog#> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix rut:    <http://rdfunit.aksw.org/ns/core#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rutt:    <http://rdfunit.aksw.org/data/tests#> .
@prefix rutp:    <http://rdfunit.aksw.org/data/patterns#> .
@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix nif: <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> .

rutt:nif-Deprecated-schema
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:WARN ;
    rut:sparqlWhere """ {
                            ?resource a ?class .
                            FILTER ( 
                                CONTAINS (str(?class), "http://nlp2rdf.lod2.eu/schema/string/") ||
                                CONTAINS (str(?class), "http://nlp2rdf.lod2.eu/schema/sso/")
                                ) 
                            # README
                            BIND (concat(str(?resource),": is using the old vocabulary (",str(?class),") a newer version is available at http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#") AS ?message)
                        } """ ;
    rut:sparqlPrevalence """  """ .

rutt:nif-isString-only-with-Context
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> , <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString>;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
                            { ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                                FILTER (NOT EXISTS {?resource  <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> ?o } )
                            }UNION{
                                ?resource  <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> [] .
                                FILTER (NOT EXISTS {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context>  } )
                            }
                            # README
                            BIND (concat(str(?resource), ": all nif:Context must have an explicit nif:isString, nif:isString can only occurr with a nif:Context") AS ?message)
                        } """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?s) AS ?total) WHERE {
                            { 
                                ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                            }UNION{
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> [] . 
                            } } """ .

rutt:nif-beginIndex-of-Context-MUST-be-zero
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:Context , nif:beginIndex ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
                         		?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#beginIndex> ?begin .
                         		FILTER (xsd:nonNegativeInteger(?begin) != xsd:nonNegativeInteger(0))

                         		# README
                         		BIND (concat(str(?resource), ": nif:beginIndex of nif:Context MUST be zero, but is ", str(?begin)) AS ?message)
                         	} """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#beginIndex> ?begin .} """ .

rutt:nif-length-of-isString-equal-with-endIndex
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:Context , nif:beginIndex, nif:endIndex ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
                         		?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> ?string .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#endIndex> ?length .
                         		BIND ( xsd:nonNegativeInteger(strlen(?string)) as ?a)
                         		BIND ( xsd:nonNegativeInteger(?length) as ?b)
                         		FILTER ( ?a != ?b  )

                         		# README
                         		BIND (concat(str(?resource), ": for the context, the length of nif:isString (",str(?a), ") must equal nif:endIndex (",str(?b),")" ) AS ?message)
                         		} """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> ?string .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#endIndex> ?length . } """ .



rutt:nif-anchorOf-must-match-the-substring-of-isString-calculated-with-begin-and-end-index
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:anchorOf , nif:beginIndex, nif:endIndex ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
                         		#not sure, if necessary -> ?s a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String> .
                         		?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#anchorOf> ?anchorOf .
                         		?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#beginIndex> ?beginIndex .
                         		?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#endIndex> ?endIndex .
                         		?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#referenceContext> [ <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> ?referenceString ]  .
                         		BIND (SUBSTR(?referenceString, ?beginIndex , (?endIndex - ?beginIndex) ) AS ?test ) .
                         	    FILTER (str(?test) != str(?anchorOf )) .


                         		# debugging query
                         		#BIND ((xsd:int(?endIndex) - xsd:int(?beginIndex))  as ?diff )
                         		#BIND ((?endIndex - ?beginIndex)   as ?diff )
                         		#BIND (concat(str(?diff), "ass") AS ?message)
                         		#BIND (SUBSTR(?referenceString, ?beginIndex , (?endIndex - ?beginIndex) ) AS ?test ) .
                         		#BIND ("anything" AS ?test ) .
                         		#BIND (concat(str(?referenceString), " " ,  ?beginIndex, ?endIndex," ", ?diff," ", ?test) AS ?message)
                         		#BIND (concat(str(?referenceString), " " ,  ?beginIndex, ?diff," "," ", ?test) AS ?message)

                         		# README - TODO this query does not work correctly
                         		BIND (concat(str(?referenceString), ": nif:anchorOf must match the substring of nif:isString calculated with begin and end index") AS ?message)
                         	} """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                #not sure, if necessary -> ?s a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String> .
                                #?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#anchorOf> ?anchorOf .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#beginIndex> ?beginIndex .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#endIndex> ?endIndex .
                                ?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#referenceContext> [ <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#isString> ?referenceString ]  . } """ .


rutt:nif-rdftype-is-misspelled
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
        ?resource a ?class .
        FILTER (
            CONTAINS (str(?class), "RFC") &&  CONTAINS (str(?class), "147String") && ! CONTAINS (str(?class), "5") ||
            CONTAINS (str(?class), "RFC5") &&  CONTAINS (str(?class), "47String") && ! CONTAINS (str(?class), "1") ||
            CONTAINS (str(?class), "RFC51") &&  CONTAINS (str(?class), "7String") && ! CONTAINS (str(?class), "4") ||
            CONTAINS (str(?class), "RFC514") &&  CONTAINS (str(?class), "String") && ! CONTAINS (str(?class), "7") ||
            CONTAINS (str(?class), "5147String")  && ! CONTAINS (str(?class), "RFC") ||
            CONTAINS (str(?class), "RFC") &&  CONTAINS (str(?class), "5147") && ! CONTAINS (str(?class), "String")
            )

        # README
        BIND (concat("rdf:type of ",str(?resource)," is misspelled: ",str(?class)) AS ?message)
    } """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                ?resource a ?class .  } """ .


rutt:nif-non-context-CString-must-have-explicit-referenceContext
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:CString, nif:CStringImpl, nif:OffsetBasedString, nif:RFC5147String, nif:referenceContext ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
        {
            {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CStringImpl>}
            UNION
            {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#OffsetBasedString>}
            UNION
            {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String>}
        }
        FILTER (NOT EXISTS {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> } ) .
        FILTER (NOT EXISTS {?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#referenceContext> [ a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> ] . } )

        # README
        BIND (concat(str(?resource), ": all nif:CString and subclasses that aren't contexts must have an explicit referenceContext") AS ?message)
        } """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CStringImpl>}
                                UNION
                                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#OffsetBasedString>}
                                UNION
                                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String>}
                            } """ . 

#TODO change to two TYPRODEP cases
rutt:nif-CString-and-subclasses-MUST-have-beginIndex-and-endIndex
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:CString, nif:CStringImpl, nif:OffsetBasedString, nif:RFC5147String, nif:referenceContext, nif:endIndex ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
        {
            {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CStringImpl>}
            UNION
            {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#OffsetBasedString>}
            UNION
            {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String>}
        }
        FILTER ( NOT EXISTS {?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#beginIndex> ?o  } 
              || NOT EXISTS {?resource <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#endIndex> ?o  }    )

        # README
        BIND ( concat(str(?resource), ":  all nif:CString and subclasses (i.e. RFC5147String, CStringImpl, OffsetBasedString) MUST have nif:beginIndex and nif:endIndex") AS ?message)
    } """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                {
                                    {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CStringImpl>}
                                    UNION
                                    {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#OffsetBasedString>}
                                    UNION
                                    {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String>}
                                }
                            } """ . 

rutt:nif-Context-must-have-rdftype-of-a-subclass-of-CString
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:CString, nif:CStringImpl, nif:OffsetBasedString, nif:RFC5147String, nif:beginIndex ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
        ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
        FILTER ( NOT EXISTS {
            {
                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CStringImpl>}
                UNION
                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#OffsetBasedString>}
                UNION
                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String>}
            }
        })

        # README
        BIND (concat(str(?resource), ": all nif:Context must have rdf:type  of a subclass of nif:CString" ) AS ?message)
    } """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#Context> .
                            } """ . 


rutt:nif-CString-is-abstract-it-MUST-only-exist-with-a-subclass
    a       rut:ManualTestCase ;
    rut:appliesTo rut:Schema ;
    rut:generated rut:ManuallyGenerated ;
    rut:references nif:CString, nif:CStringImpl, nif:OffsetBasedString, nif:RFC5147String ;
    rut:source <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#> ;
    rut:testCaseLogLevel rlog:ERROR ;
    rut:sparqlWhere """ {
        ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CString> .
        FILTER ( NOT EXISTS {
            {
                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CStringImpl>}
                UNION
                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#OffsetBasedString>}
                UNION
                {?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#RFC5147String>}
            }
        })

        # README
        BIND (concat(str(?resource), ": nif:CString is an abstract class, it MUST only exist, if a subclass is used as well (e.g. CStringImpl, RFC5147String, OffsetBasedString)" ) AS ?message)
    } """ ;
    rut:sparqlPrevalence """ SELECT (count( DISTINCT ?resource) AS ?total) WHERE {
                                ?resource a <http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#CString> .
                            } """ . 
