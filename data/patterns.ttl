@prefix tddp: <http://databugger.aksw.org/patterns#> .
@prefix tddo: <http://databugger.aksw.org/ontology#> .
@prefix tddg: <http://databugger.aksw.org/generators#> .

@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .


##########################################
#### rdfs:range pattern
##########################################

tddp:RDFSRANGE a tddo:Pattern ;
    dcterms:identifier "RDFSRANGE" ;
    dcterms:description """Emulates the rdfs:range constrain. Can use the rdf:type as transitive using the '+' operator"""@en ;
    tddo:patternSPARQL """ SELECT ?c WHERE {
                            ?s %%P1%% ?c.
                            FILTER NOT EXISTS {?c rdf:type%%OP%% %%T1%%} } """ ;
    tddo:patternPrevalenceSPARQL """ SELECT (count(distinct ?c) AS ?total) where { ?s %%P1%% ?c .} """ ;
    tddo:selectVariable "c" ;
    tddo:parameter tddp:RDFSRANGE-P1 ;
    tddo:parameter tddp:RDFSRANGE-OP ;
    tddo:parameter tddp:RDFSRANGE-T1 .


tddp:RDFSRANGE-P1 a tddo:Parameter ;
    dcterms:identifier "P1" ;
    tddo:parameterConstraint tddo:Property .

tddp:RDFSRANGE-OP a tddo:Parameter ;
    dcterms:identifier "OP" ;
    tddo:parameterConstraint tddo:Operator ;
    tddo:constrainPattern """+|""".

tddp:RDFSRANGE-T1 a tddo:Parameter ;
    dcterms:identifier "T1" ;
    tddo:parameterConstraint tddo:Class .

##########################################
#### rdfs:domain pattern
##########################################

tddp:RDFSDOMAIN a tddo:Pattern ;
    dcterms:identifier "RDFSDOMAIN" ;
    dcterms:description """Emulates the rdfs:domain constrain. It can be extended by using specific values in V1 or making rdf:type transitive using the '+' operator"""@en ;
    tddo:patternSPARQL """ SELECT distinct ?s where {
                                 ?s %%P1%% %%V1%%
                                 FILTER NOT EXISTS {?s rdf:type%%OP%% %%T1%%} } """ ;
    tddo:patternPrevalenceSPARQL """ SELECT (count(distinct ?s) AS ?total) where { ?s %%P1%% ?c .} """ ;
    tddo:selectVariable "s" ;
    tddo:parameter tddp:RDFSDOMAIN-P1 ;
    tddo:parameter tddp:RDFSDOMAIN-V1 ;
    tddo:parameter tddp:RDFSDOMAIN-OP ;
    tddo:parameter tddp:RDFSDOMAIN-T1 .

tddp:RDFSDOMAIN-P1 a tddo:Parameter ;
    dcterms:identifier "P1" ;
    tddo:parameterConstraint tddo:Property .

tddp:RDFSDOMAIN-V1 a tddo:Parameter ;
    dcterms:identifier "V1" .

tddp:RDFSDOMAIN-OP a tddo:Parameter ;
    dcterms:identifier "OP" ;
    tddo:parameterConstraint tddo:Operator ;
    tddo:constrainPattern """+|\\*|""".

tddp:RDFSDOMAIN-T1 a tddo:Parameter ;
    dcterms:identifier "T1" ;
    tddo:parameterConstraint tddo:Class .


##########################################
#### owl:disjointClass pattern
##########################################

tddp:OWLDISJC a tddo:Pattern ;
    dcterms:identifier "OWLDISJC" ;
    dcterms:description """Emulates the owl:disjointClass constrain"""@en ;
    tddo:patternSPARQL """ SELECT ?s WHERE {
                           ?s rdf:type %%T1%% .
                           ?s rdf:type %%T2%% .} """ ;
    tddo:patternPrevalenceSPARQL """  """ ;
    tddo:selectVariable "s" ;
    tddo:parameter tddp:OWLDISJC-T1 ;
    tddo:parameter tddp:OWLDISJC-T2 .

tddp:OWLDISJC-T1 a tddo:Parameter ;
    dcterms:identifier "T1" ;
    tddo:parameterConstraint tddo:Class .

tddp:OWLDISJC-T2 a tddo:Parameter ;
    dcterms:identifier "T2" ;
    tddo:parameterConstraint tddo:Class .

##########################################
#### owl cardinality constrains pattern
##########################################

tddp:OWLCARD a tddo:Pattern ;
      dcterms:identifier "OWLCARD" ;
      dcterms:description """Emulates the owl:cardinality constrain"""@en ;
      tddo:patternSPARQL """ SELECT ?s WHERE {
                                   ?s %%P1%% ?c.
                                 } GROUP BY ?s
                                 HAVING count(?c) %%OP%% %%V1%% """ ;
      tddo:patternPrevalenceSPARQL """ SELECT  (count(distinct ?s) AS ?total) WHERE { ?s %%P1%% ?c. }""" ;
      tddo:selectVariable "s" ;
      tddo:parameter tddp:OWLCARD-P1 ;
      tddo:parameter tddp:OWLCARD-OP ;
      tddo:parameter tddp:OWLCARD-V1 .

tddp:OWLCARD-P1 a tddo:Parameter ;
      dcterms:identifier "P1" ;
      tddo:parameterConstraint tddo:Property .

tddp:OWLCARD-OP a tddo:Parameter ;
      dcterms:identifier "OP" ;
      tddo:parameterConstraint tddo:Operator ;
      tddo:constrainPattern """<|<=|>|>=|=|!=""" .

tddp:OWLCARD-V1 a tddo:Parameter ;
      dcterms:identifier "V1" ;
      tddo:parameterConstraint tddo:None ;
      tddo:constrainPattern """[0-9]*""" .


##########################################
#### Type & Property dependency (equivalent to card > 0)
##########################################

tddp:TYPRODEP a tddo:Pattern ;
      dcterms:identifier "TYPRODEP" ;
      dcterms:description """ A property must exist in a class instance"""@en ;
      tddo:patternSPARQL """ SELECT ?s WHERE {
                             ?s rdf:type%%OP%% %%T1%% .
                             FILTER NOT EXISTS {?s %%P1%% ?v } } """ ;
      tddo:patternPrevalenceSPARQL """ SELECT  (count(distinct ?s) AS ?total) WHERE { ?s rdf:type%%OP%% %%T1%% . } """ ;
      tddo:selectVariable "s" ;
      tddo:parameter tddp:TYPRODEP-T1 ;
      tddo:parameter tddp:TYPRODEP-OP ;
      tddo:parameter tddp:TYPRODEP-P1 .

tddp:TYPRODEP-T1 a tddo:Parameter ;
      dcterms:identifier "T1" ;
      tddo:parameterConstraint tddo:Class .

tddp:TYPRODEP-T1 a tddo:Parameter ;
      dcterms:identifier "OP"  ;
      tddo:parameterConstraint tddo:Operator ;
      tddo:constrainPattern """+|\\*|""".

tddp:TYPRODEP-P1 a tddo:Parameter ;
      dcterms:identifier "P1" ;
      tddo:parameterConstraint tddo:Property .

